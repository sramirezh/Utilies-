"""
This script analyzes chunk-averaged data generated by LAMMPS
The chunk files should be SPlitted before using Chunk_Splitter.sh

It prints the force factor for pressure driven simulations and also other geometrical parameters. 

It generates a file "Sconcentration.dat" that has the averages of all data and then if there are stress per atom, computes the 
pressure.

"""

import numpy as np



#Reading the times to make it easier to read the file by chunks
Times=np.loadtxt("Times.dat",dtype=int)
x=np.size(Times)

#Getting the shape of the data array 
File_Name=str(int(Times[0]))+".cxyz"
n,m=np.shape(np.loadtxt(File_Name,skiprows=2)) 


"""
Computing the averages and other parameters
"""
Concentration=np.zeros((n,2))
for k in xrange(1): #Runs over the sampled times.
    print("Reading configuration %d of %d" %(k,x-1))
    File_Name=str(int(Times[k]))+".cxyz"
    Chunk_Results=np.loadtxt(File_Name,skiprows=2)
    
    #Getting the maximum position of the surface.
    
    if k==0: #This just has to be evaluated once 
        Maxz=-100
        Minz=10000
        Maxf=0
        Nfluid=0
        for i in xrange(n):
            if Chunk_Results[i,0]==3:
                Maxz=max(Maxz,Chunk_Results[i,3])
                Minz=min(Minz,Chunk_Results[i,3])
            else:
                Maxf=max(Maxf,Chunk_Results[i,3])
                Nfluid+=1
                
    print "The maximum height of the solid surface is %lf and the minimum is %lf" %(Maxz,Minz)
    print "The height of the solid surface is %lf" %(Maxz-Minz)
            
    #Checking if the solutes go through the surface,
    for i in xrange(n):
        if Chunk_Results[i,0]==2 and Chunk_Results[i,3] < Maxz:
            print "upsssss"

#Getting the density
Volume=(35-Maxz)*17*17
Ff=Volume/Nfluid

print "The vol is %lf, Number of fluid particles is %lf and the Ff is %lf" %(Volume,Nfluid,Ff)


#"""
#Creating the output file
#"""
#np.savetxt("SConcentration.dat",Concentration)
#
#
##For Testing Porpuses
#import matplotlib.pyplot as plt
#plt.plot(Concentration[:,0],Concentration[:,1],'*')
