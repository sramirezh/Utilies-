"""
This script analyzes chunk-averaged data generated by LAMMPS
The chunk files should be SPlitted before using Concentration.sh
In order to perform the Concentration analysis, the chunk extensions, should be as follow:

.chunks for solute properties. 
.chunk for solute+solvent properties.

It prints the value of the force factor

"""

import numpy as np


#Reading the times to make it easier to read the file by chunks
Times=np.loadtxt("Times.dat",dtype=int)
x=np.size(Times)

#Getting the shape of the data array 
File_Name=str(int(Times[0]))+".chunk"
FirstChunk=np.loadtxt(File_Name,skiprows=1)
n,m=np.shape(FirstChunk) 

Averages=np.zeros((n,2))


#Getting the zshift
f=open("Zshift.dat")
zshift=np.float(f.readline())
f.close()
 
Averages[:,0]=FirstChunk[:,1]-zshift
"""
Computing the averages and other parameters
"""
BulkSolutes=[]
BulkTotal=[]

#These parameters define the bulk region
zmin=15
zmax=25

for k in xrange(x): #Runs over the sampled times.
   # print("Reading configuration %d of %d" %(k,x-1))
    SFile_Name=str(int(Times[k]))+".chunks"
    File_Name=str(int(Times[k]))+".chunk"
    
    Chunk_Results=np.loadtxt(File_Name,skiprows=1) 
    SChunk_Results=np.loadtxt(SFile_Name,skiprows=1)
    BSvector=[]
    BTvector=[]
    for i in xrange(n):          
        #Computing the bulk concentration as defined by Bocquet.
        if Averages[i,0]>=zmin and Averages[i,0]<=zmax:
            BSvector.append(SChunk_Results[i,2])
            BTvector.append(Chunk_Results[i,2])
            
    BulkSolutes.append(np.sum(BSvector))
    BulkTotal.append(np.sum(BTvector))
Ns=np.average(BulkSolutes)
Nb=np.average(BulkTotal)
Ffactor=Nb/(Nb-Ns)

print "The average number of solutes in the bulk is Ns %f" %Ns
print "The average number of fluid (Solvent+solute) particles in the bulk Nb %f" %Nb
print "The force factor is %f" %Ffactor
                       
#"""
#Creating the output file
#"""
#np.savetxt("SConcentration.dat",Concentration)
#
#
#"""
#Uncomment for testing
#"""
# 
#import matplotlib.pyplot as plt
#plt.figure(1)
#plt.plot(BulkSolutes)
#plt.plot(BulkTotal)

#x=np.linspace(min(Concentration[:,0]),max(Concentration[:,0]))
#y=np.zeros(len(x))
#y[:]=BulkC
#plt.plot(x,y)
#plt.xlim([0,25])


#plt.figure(2)
#
#plt.plot(Concentration[:,0],Integrand)
#x=np.linspace(min(Concentration[:,0]),max(Concentration[:,0]))
#y=np.zeros(len(x))
#plt.plot(x,y)
#plt.xlim([0,8])
